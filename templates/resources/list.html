{% extends 'base.html' %}

{% block content %}
<h2>Ressources</h2>

<form class="row g-3 mb-4" method="get">
    <div class="col-md-4">
        <select name="subject" class="form-select" onchange="this.form.submit()">
            <option value="">Toutes les matières</option>
            {% for s in subjects %}
            <option value="{{ s.id }}" {% if request.GET.subject == s.id|stringformat:"i" %}selected{% endif %}>{{ s.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-4">
        <select name="level" class="form-select" onchange="this.form.submit()">
            <option value="">Tous les niveaux</option>
            {% for l in levels %}
            <option value="{{ l.id }}" {% if request.GET.level == l.id|stringformat:"i" %}selected{% endif %}>{{ l.name }}</option>
            {% endfor %}
        </select>
    </div>
</form>

{% if user.is_authenticated and user.is_teacher %}
<a href="{% url 'upload_resource' %}" class="btn btn-primary mb-3">Ajouter un exercice</a>
{% endif %}

<div class="row">
    <div class="col-md-6">
        <h3>Exercices</h3>
        <div class="list-group">
            {% for exercise in exercises %}
            <a href="{{ exercise.file.url }}" class="list-group-item list-group-item-action">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">{{ exercise.title }}</h5>
                    <small>{{ exercise.created_at|date:"d/m/Y" }}</small>
                </div>
                <p class="mb-1">{{ exercise.subject }} - {{ exercise.level }}</p>
                <small>{{ exercise.topic }}</small>
                {% if exercise.solution_file %}
                <br><span class="badge bg-success">Corrigé disponible</span>
                {% endif %}
            </a>
            {% empty %}
            <p>Aucun exercice trouvé.</p>
            {% endfor %}
        </div>
    </div>
    <div class="col-md-6">
        <h3>Vidéos</h3>
        <div class="list-group">
            {% for video in videos %}
            <div class="list-group-item">
                <h5>{{ video.title }}</h5>
                <p>{{ video.description }}</p>
                <a href="{{ video.url }}" target="_blank" class="btn btn-sm btn-outline-danger">Voir sur YouTube</a>
            </div>
            {% empty %}
            <p>Aucune vidéo trouvée.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
